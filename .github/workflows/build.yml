name: Arduino CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Arduino CLI
      uses: arduino/setup-arduino-cli@v1

    - name: Update Arduino CLI
      run: |
        arduino-cli core update-index

    - name: Install Arduino Mega core
      run: |
        arduino-cli core install arduino:megaavr
        arduino-cli core install arduino:avr

    - name: Install required libraries
      run: |
        # Install PID_v1 library
        arduino-cli lib install "PID"

        # Enable git-url installations for YFROBOT Motor Driver Library
        arduino-cli config set library.enable_unsafe_install true

        # Install YFROBOT Motor Driver Library from GitHub
        arduino-cli lib install --git-url https://github.com/YFROBOT-TM/Yfrobot-Motor-Driver-Library.git

    - name: Compile Omni Motor Control sketch
      run: |
        cd omni_motor_control
        arduino-cli compile --fqbn arduino:avr:mega omni_motor_control.ino

    - name: Compile I2C Scanner sketch
      run: |
        cd i2c_scanner
        arduino-cli compile --fqbn arduino:avr:mega i2c_scanner.ino

    - name: Verify compilation success
      run: |
        echo "âœ… All Arduino sketches compiled successfully!"
        echo "ðŸ“‹ Build Summary:"
        echo "  - Omni Motor Control: âœ… Compiled"
        echo "  - I2C Scanner: âœ… Compiled"
        echo "  - Target Board: Arduino Mega (ATmega2560)"
